<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do App</title>
    <link rel="stylesheet" href="/static/css/home.css" />
  </head>

  <body>
    <!-- Floating Profile Button -->
    <button id="profileBtn" onclick="goToProfile()">
      <img src="/static/img/profile.svg" alt="Profile" />
    </button>

    <!-- Main App Container -->
    <main class="container">
      <header>
        <h1>âœ¨ My To-Do List</h1>
      </header>

      <section class="input-section">
        <input
          type="text"
          id="taskInput"
          placeholder="What needs to be done?"
        />
        <button class="add-btn" onclick="addTask()">Add</button>
      </section>

      <ul id="taskList" class="task-list">
        <!--Tasks will automaticly be added here-->
        {% for task in tasks %}
        <li>
          <span> {{ task.task }} </span>
          <div class="btn-group">
            <button onclick="editTask('{{ task.id }}')">
              <img src="/static/img/edit.svg" alt="Edit task button" />
            </button>
            <button onclick="deleteTask('{{task.id}}')">
              <img src="/static/img/delete.svg" alt="Delete task button" />
            </button>
          </div>
        </li>
        {%endfor%}
      </ul>
    </main>

    <script>
      function addTask() {
        const input = document.getElementById("taskInput");
        const taskText = input.value.trim();
        if (taskText) {
          const li = document.createElement("li");

          fetch("/tasks", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ taskText: taskText }),
          });

          input.value = ""
        }
      }

      function editTask(taskId) {
        const newContent = prompt("Edit content for Task:");
        if (newContent !== null) {
          fetch(`/edit_task/${taskId}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ content: newContent }),
          });
        }
      }

      function deleteTask(taskId) {
        fetch(`/edit_task/${taskId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({delete:"deleting content"}),
        });
      }

      function goToProfile() {
        window.location.href =
          "{{ url_for('profile_page', username=current_user.username) }}";
      }
    </script>
  </body>
</html>
